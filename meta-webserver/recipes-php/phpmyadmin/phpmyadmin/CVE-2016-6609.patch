From a82835cf09c20b381b9c8a7bfe337a11ab904ab2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Thu, 30 Jun 2016 10:22:39 +0200
Subject: [PATCH] Generate valid PHP code even when table/database name
 contains PHP markup
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 libraries/plugins/export/ExportPhparray.php |   25 +++++++++++++++++++------
 1 file changed, 19 insertions(+), 6 deletions(-)

diff --git a/libraries/plugins/export/ExportPhparray.php b/libraries/plugins/export/ExportPhparray.php
index 4a48f10..4fd224d 100644
--- a/libraries/plugins/export/ExportPhparray.php
+++ b/libraries/plugins/export/ExportPhparray.php
@@ -66,6 +66,19 @@ class ExportPhparray extends ExportPlugin
     }
 
     /**
+     * Removes end of comment from a string
+     *
+     * @param string $string String to replace
+     *
+     * @return string
+     */
+    public function commentString($string)
+    {
+        return strtr($string, '*/', '-');
+    }
+
+
+    /**
      * Outputs export header
      *
      * @return bool Whether it succeeded
@@ -107,9 +120,9 @@ class ExportPhparray extends ExportPlugin
             $db_alias = $db;
         }
         PMA_exportOutputHandler(
-            '//' . $GLOBALS['crlf']
-            . '// Database ' . PMA\libraries\Util::backquote($db_alias)
-            . $GLOBALS['crlf'] . '//' . $GLOBALS['crlf']
+            '/**' . $GLOBALS['crlf']
+            . ' * Database ' . $this->commentString(PMA\libraries\Util::backquote($db_alias))
+            . $GLOBALS['crlf'] . ' */' . $GLOBALS['crlf']
         );
 
         return true;
@@ -207,9 +220,9 @@ class ExportPhparray extends ExportPlugin
         $buffer = '';
         $record_cnt = 0;
         // Output table name as comment
-        $buffer .= $crlf . '// '
-            . PMA\libraries\Util::backquote($db_alias) . '.'
-            . PMA\libraries\Util::backquote($table_alias) . $crlf;
+        $buffer .= $crlf . '/* '
+            . $this->commentString(PMA\libraries\Util::backquote($db_alias)) . '.'
+            . $this->commentString(PMA\libraries\Util::backquote($table_alias)) . ' */' . $crlf;
         $buffer .= '$' . $tablefixed . ' = array(';
 
         while ($record = $GLOBALS['dbi']->fetchRow($result)) {
-- 
1.7.9.5

