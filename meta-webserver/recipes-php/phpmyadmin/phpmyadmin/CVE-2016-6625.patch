From e67e69229a1df3a26df12b1bae89065834fd85b4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Sat, 23 Jul 2016 11:31:46 +0200
Subject: [PATCH] Remove option to show phpinfo() ($cfg['ShowPhpInfo'])
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This is really more a PHP debugging feature than anything related to
phpMyAdmin. If user wants to debug, it's as simple a creating file with
one line of php code.

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 doc/config.rst                    |   14 +-------------
 index.php                         |   11 +----------
 libraries/common.inc.php          |    1 -
 libraries/config.default.php      |    7 -------
 libraries/config/messages.inc.php |    5 -----
 libraries/config/setup.forms.php  |    1 -
 phpinfo.php                       |   22 ----------------------
 7 files changed, 2 insertions(+), 59 deletions(-)
 delete mode 100644 phpinfo.php

diff --git a/doc/config.rst b/doc/config.rst
index 9f1b569..05c77a4 100644
--- a/doc/config.rst
+++ b/doc/config.rst
@@ -1823,11 +1823,6 @@ Main panel
     You can additionally hide more information by using
     :config:option:`$cfg['Servers'][$i]['verbose']`.
 
-.. config:option:: $cfg['ShowPhpInfo']
-
-    :type: boolean
-    :default: false
-
 .. config:option:: $cfg['ShowChgPassword']
 
     :type: boolean
@@ -1838,18 +1833,11 @@ Main panel
     :type: boolean
     :default: true
 
-    Defines whether to display the :guilabel:`PHP information` and
+    Defines whether to display the 
     :guilabel:`Change password` links and form for creating database or not at
     the starting main (right) frame. This setting does not check MySQL commands
     entered directly.
 
-    Please note that to block the usage of ``phpinfo()`` in scripts, you have to
-    put this in your :file:`php.ini`:
-
-    .. code-block:: ini
-
-        disable_functions = phpinfo()
-
     Also note that enabling the :guilabel:`Change password` link has no effect
     with config authentication mode: because of the hard coded password value
     in the configuration file, end users can't be allowed to change their
diff --git a/index.php b/index.php
index e4bbba1..2e6bb3b 100644
--- a/index.php
+++ b/index.php
@@ -317,7 +317,7 @@ if ($server > 0 && $GLOBALS['cfg']['ShowServerInfo']) {
        . ' </div>';
 }
 
-if ($GLOBALS['cfg']['ShowServerInfo'] || $GLOBALS['cfg']['ShowPhpInfo']) {
+if ($GLOBALS['cfg']['ShowServerInfo']) {
     echo '<div class="group">';
     echo '<h2>' , __('Web server') , '</h2>';
     echo '<ul>';
@@ -357,15 +357,6 @@ if ($GLOBALS['cfg']['ShowServerInfo'] || $GLOBALS['cfg']['ShowPhpInfo']) {
         }
     }
 
-    if ($cfg['ShowPhpInfo']) {
-        PMA_printListItem(
-            __('Show PHP information'),
-            'li_phpinfo',
-            'phpinfo.php' . $common_url_query,
-            null,
-            '_blank'
-        );
-    }
     echo '  </ul>';
     echo ' </div>';
 }
diff --git a/libraries/common.inc.php b/libraries/common.inc.php
index 8193322..9ec0fc3 100644
--- a/libraries/common.inc.php
+++ b/libraries/common.inc.php
@@ -309,7 +309,6 @@ $goto_whitelist = array(
     'index.php',
     'pdf_pages.php',
     'pdf_schema.php',
-    //'phpinfo.php',
     'server_binlog.php',
     'server_collations.php',
     'server_databases.php',
diff --git a/libraries/config.default.php b/libraries/config.default.php
index 0288fae..272d082 100644
--- a/libraries/config.default.php
+++ b/libraries/config.default.php
@@ -1039,13 +1039,6 @@ $cfg['NavigationTreeShowEvents'] = true;
 $cfg['ShowStats'] = true;
 
 /**
- * show PHP info link
- *
- * @global boolean $cfg['ShowPhpInfo']
- */
-$cfg['ShowPhpInfo'] = false;
-
-/**
  * show MySQL server and web server information
  *
  * @global boolean $cfg['ShowServerInfo']
diff --git a/libraries/config/messages.inc.php b/libraries/config/messages.inc.php
index 57ec672..eae35f1 100644
--- a/libraries/config/messages.inc.php
+++ b/libraries/config/messages.inc.php
@@ -865,11 +865,6 @@ $strConfigShowFunctionFields_desc = __(
 $strConfigShowFunctionFields_name = __('Show function fields');
 $strConfigShowHint_desc = __('Whether to show hint or not.');
 $strConfigShowHint_name = __('Show hint');
-$strConfigShowPhpInfo_desc = __(
-    'Shows link to [a@https://php.net/manual/function.phpinfo.php]phpinfo()[/a] ' .
-    'output.'
-);
-$strConfigShowPhpInfo_name = __('Show phpinfo() link');
 $strConfigShowServerInfo_name = __('Show detailed MySQL server information');
 $strConfigShowSQL_desc = __(
     'Defines whether SQL queries generated by phpMyAdmin should be displayed.'
diff --git a/libraries/config/setup.forms.php b/libraries/config/setup.forms.php
index cfffe9d..c8743d4 100644
--- a/libraries/config/setup.forms.php
+++ b/libraries/config/setup.forms.php
@@ -203,7 +203,6 @@ $forms['Main_panel']['Startup'] = array(
     'ShowCreateDb',
     'ShowStats',
     'ShowServerInfo',
-    'ShowPhpInfo',
     'ShowChgPassword');
 $forms['Main_panel']['DbStructure'] = array(
     'ShowDbStructureComment',
diff --git a/phpinfo.php b/phpinfo.php
deleted file mode 100644
index 6ac84c7..0000000
--- a/phpinfo.php
+++ /dev/null
@@ -1,20 +0,0 @@
-<?php
-/* vim: set expandtab sw=4 ts=4 sts=4: */
-/**
- * phpinfo() wrapper to allow displaying only when configured to do so.
- *
- * @package PhpMyAdmin
- */
-
-/**
- * Gets core libraries and defines some variables
- */
-require_once 'libraries/common.inc.php';
-PMA\libraries\Response::getInstance()->disable();
-
-/**
- * Displays PHP information
- */
-if ($GLOBALS['cfg']['ShowPhpInfo']) {
-    phpinfo();
-}
-- 
1.7.9.5

