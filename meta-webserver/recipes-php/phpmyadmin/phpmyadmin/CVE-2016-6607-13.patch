From c3a3531b61bb0c886d4d6838356c32f655a1123c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Wed, 13 Jul 2016 10:32:55 +0200
Subject: [PATCH] Escape HTML markup in transformation wrapper
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

...in case content type is html.

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 transformation_wrapper.php |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/transformation_wrapper.php b/transformation_wrapper.php
index 48ae3a0..8a8e3ca 100644
--- a/transformation_wrapper.php
+++ b/transformation_wrapper.php
@@ -111,7 +111,11 @@ if (isset($ct) && ! empty($ct)) {
 PMA_downloadHeader($cn, $mime_type);
 
 if (! isset($_REQUEST['resize'])) {
-    echo $row[$transform_key];
+    if (stripos($mime_type, 'html') === false) {
+        echo $row[$transform_key];
+    } else {
+        echo htmlspecialchars($row[$transform_key]);
+    }
 } else {
     // if image_*__inline.inc.php finds that we can resize,
     // it sets the resize parameter to jpeg or png
-- 
1.7.9.5

