From 77b9208db08be891fa2f63c40c249b3b641dcc03 Mon Sep 17 00:00:00 2001
From: Denis Ovsienko <denis@ovsienko.info>
Date: Mon, 16 Jan 2017 11:19:00 +0000
Subject: [PATCH] CVE-2017-5205/add a test case

The .pcap file comes from Francois-Xavier Le Bail.
---
 tests/TESTLIST                |    2 ++
 tests/ikev2pI2-segfault-v.out |    8 ++++++++
 tests/ikev2pI2-segfault.out   |    1 +
 tests/ikev2pI2-segfault.pcap  |  Bin 0 -> 656 bytes
 4 files changed, 11 insertions(+)
 create mode 100644 tests/ikev2pI2-segfault-v.out
 create mode 100644 tests/ikev2pI2-segfault.out
 create mode 100644 tests/ikev2pI2-segfault.pcap

diff --git a/tests/TESTLIST b/tests/TESTLIST
index 7b487e0..1e6edfd 100644
--- a/tests/TESTLIST
+++ b/tests/TESTLIST
@@ -56,6 +56,8 @@ ikev2four	ikev2four.pcap		ikev2four.out	-t -v
 ikev2fourv	ikev2four.pcap		ikev2fourv.out	-t -v -v -v
 ikev2fourv4	ikev2four.pcap		ikev2fourv4.out	-t -v -v -v -v
 # ikev2pI2 test in crypto.sh
+ikev2pI2-segfault	ikev2pI2-segfault.pcap	ikev2pI2-segfault.out	-t
+ikev2pI2-segfault-v	ikev2pI2-segfault.pcap	ikev2pI2-segfault-v.out	-t -v
 
 # IETF ROLL RPL packets
 dio02           rpl-19-pickdag.pcap         rpl-19-pickdag.out  -t -v -v
diff --git a/tests/ikev2pI2-segfault-v.out b/tests/ikev2pI2-segfault-v.out
new file mode 100644
index 0000000..a690ef9
--- /dev/null
+++ b/tests/ikev2pI2-segfault-v.out
@@ -0,0 +1,8 @@
+IP (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto UDP (17), length 536, bad cksum 0 (->f48e)!)
+    192.1.2.45.500 > 192.1.2.23.500: isakmp 2.0 msgid 00000000: parent_sa ikev2_init[I]:
+    (sa[C]: len=240
+        (p: #1 protoid=isakmp transform=4 len=40
+            (t: #1 type=encr id=#26380 )
+            (t: #2 type=integ id=hmac-sha )
+            (t: #3 type=prf id=hmac-sha )
+            (v2e)) [|v2sa]) [|v2ke]
diff --git a/tests/ikev2pI2-segfault.out b/tests/ikev2pI2-segfault.out
new file mode 100644
index 0000000..c7f0281
--- /dev/null
+++ b/tests/ikev2pI2-segfault.out
@@ -0,0 +1 @@
+IP 192.1.2.45.500 > 192.1.2.23.500: isakmp: parent_sa ikev2_init[I]
diff --git a/tests/ikev2pI2-segfault.pcap b/tests/ikev2pI2-segfault.pcap
new file mode 100644
index 0000000000000000000000000000000000000000..43a7e28409b4ab6bf71d9ed0461d95e87a86972c
GIT binary patch
literal 656
zcmd<$<>fMAU|{gI(UxKa(*L1=g@K>JH6^noIk7;&P|wm*&(HuU%fJ9q3sR>5#2|2o
zm4Sg1D8dHeg2h2>8zzW=2#89!E-M4%gD^<gm4QhDB<vu_z;J+(Nf(I48NV=oVPXLa
zGBPo<u(Gj(<Uv4DL5TyxV*I1j!0-jAUxSg6frXiYfrF7Dod-k%F_RvUh8oY|%)qc}
L6b!u(0HqlKzl1yv

literal 0
HcmV?d00001

-- 
1.7.9.5

